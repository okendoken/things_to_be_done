<ul class="nav">
  <% if user_signed_in? %>
      <%= render :partial => 'partials/notifications_link' %>
      <li><%= link_to t(:sign_out), destroy_user_session_path, :method => :delete, :class => "btn-success spike" %></li>
  <% else %>
      <% if display_vk_login? %>
          <li><%= link_to 'контакте',
                          user_omniauth_authorize_path(:vkontakte), :class => "vk-login-button",
                          :"data-width" => 600, :"data-height" => 400 %></li>
      <% else %>
          <li><%= link_to 'twitter',
                          user_omniauth_authorize_path(:twitter), :class => "tw-login-button btn-success",
                          :"data-width" => 600, :"data-height" => 400 %></li>
          <li><%= link_to 'facebook',
                          user_omniauth_authorize_path(:facebook), :class => "fb-login-button btn-success",
                          :"data-width" => 600, :"data-height" => 400 %></li>
      <% end %>
      <li><%= link_to t(:sign_in), '', :class => "btn-success spike", :id => "sign-in-link" %></li>
  <% end %>
</ul>

<div id="login-dialog">
  <div id="login-dialog-content">
    <%= form_for("user", :url => user_session_path) do |f| %>
        <div class="row">
          <%= f.label "E-mail", :class => 'span1' %>
          <span class="span2">
            <%= f.email_field :email, :size => 20, :class => 'span2-2' %>
          </span>
        </div>
        <div class="row">
          <%= f.label t(:password), :class => 'span1' %>
          <span class="span2">
            <%= f.password_field :password, :size => 20, :class => 'span2-2' %>
          </span>
        </div>
        <div class="row">
          <%= link_to t(:sign_up), new_user_registration_path, :class => 'span3' %>
        </div>
        <div class="row immediate-login-controls">
          <span class="span1">
          <button class="btn" type="button" id="cancel-btn"><%= t(:cancel) %></button>
          </span>
          <%= f.submit t(:sign_in), :class => 'btn-success spike', :id => 'submit-btn' %>
        </div>
        <div class="row provider-links">
          <% if display_vk_login? %>
            <span>
            <%= link_to 'facebook',
                        user_omniauth_authorize_path(:facebook), :class => "fb-login-button btn-success",
                        :"data-width" => 600, :"data-height" => 400 %>
            </span>
            <span>
            <%= link_to 'twitter', user_omniauth_authorize_path(:twitter), :class => "tw-login-button btn-success",
                        :"data-width" => 600, :"data-height" => 400 %>
            </span>
          <% end %>
        </div>
    <% end %>
  </div>
</div>

<% if user_signed_in? %>
    <%= render :partial => 'partials/notifications_dialog' %>
<% end %>
<script>
    $(function () {
        $("#sign-in-link").click(function () {
            $("#login-dialog").slideDown(230);
            return false;
        });
        $("#cancel-btn").click(function () {
            $("#login-dialog").slideUp(230);
            return false;
        });
        $(".fb-login-button").click(function (e) {
            popupCenter($(this).attr("href"), $(this).attr("data-width"), $(this).attr("data-height"), "authPopup");
            e.stopPropagation();
            return false;
        });
        $(".tw-login-button").click(function (e) {
            popupCenter($(this).attr("href"), $(this).attr("data-width"), $(this).attr("data-height"), "authPopup");
            e.stopPropagation();
            return false;
        });
        $(".vk-login-button").click(function (e) {
            popupCenter($(this).attr("href"), $(this).attr("data-width"), $(this).attr("data-height"), "authPopup");
            e.stopPropagation();
            return false;
        });
    });
</script>